<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Library UI</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg: #0f1226;
        --text: #e9ecf1;
        --muted: #a6adbb;
        --card: #171a33;
        --border: #2a2f55;
        --primary: #6c5ce7;
        --primary-600: #5a49e4;
        --accent: #00d4ff;
        --danger: #ff5c7a;
        --success: #2dd4bf;
        --shadow: 0 10px 30px rgba(0,0,0,0.25);
      }

      @media (prefers-color-scheme: light) {
        :root {
          --bg: #f6f7fb;
          --text: #0e1320;
          --muted: #5b6472;
          --card: #ffffff;
          --border: #e7e9f0;
          --primary: #6c5ce7;
          --primary-600: #5949e0;
          --accent: #00bcd4;
          --danger: #e91e63;
          --success: #10b981;
          --shadow: 0 10px 30px rgba(17,24,39,0.12);
        }
      }

      body {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        margin: 0;
        color: var(--text);
        background: radial-gradient(1000px 600px at 20% -10%, rgba(108,92,231,0.25), transparent),
                    radial-gradient(900px 500px at 120% 0%, rgba(0,212,255,0.25), transparent),
                    var(--bg);
        min-height: 100vh;
      }

      .hero {
        background: linear-gradient(120deg, var(--primary), var(--accent));
        color: white;
        padding: 36px 0;
        box-shadow: var(--shadow);
      }

      .container { max-width: 960px; margin: 0 auto; padding: 24px; }
      .hero .container { padding: 0 24px; }

      h1 { margin: 0; font-size: 28px; letter-spacing: 0.3px; }
      .subtitle { margin-top: 6px; opacity: 0.9; font-size: 14px; }

      .surface { margin-top: -28px; }
      .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
      @media (min-width: 900px) { .grid { grid-template-columns: 1fr; } }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        box-shadow: var(--shadow);
      }

      .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

      input {
        padding: 10px 12px;
        font-size: 14px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--text);
        outline: none;
        transition: border-color .2s ease, box-shadow .2s ease;
      }
      input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(108,92,231,0.2); }

      .btn {
        padding: 10px 14px; font-size: 14px; cursor: pointer; border-radius: 10px; border: 0;
        display: inline-flex; align-items: center; gap: 8px; transition: transform .06s ease, opacity .2s ease;
      }
      .btn:hover { transform: translateY(-1px); }
      .btn:active { transform: translateY(0); }
      .btn-primary { background: var(--primary); color: #fff; }
      .btn-primary:hover { background: var(--primary-600); }
      .btn-outline { background: transparent; color: var(--primary); border: 1px solid var(--primary); }
      .btn-danger { background: var(--danger); color: #fff; }

      table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 12px; }
      thead th { background: linear-gradient(120deg, rgba(108,92,231,0.15), rgba(0,212,255,0.15)); color: var(--text); }
      th, td { border-bottom: 1px solid var(--border); padding: 12px; text-align: left; font-size: 14px; }
      tbody tr:nth-child(odd) { background: rgba(255,255,255,0.02); }

      .muted { color: var(--muted); font-size: 12px; }
      .error { color: var(--danger); margin-top: 8px; }
      .success { color: var(--success); margin-top: 8px; }

      .footer { text-align: center; margin-top: 24px; color: var(--muted); font-size: 12px; }
    </style>
  </head>
  <body>
    <div class="hero">
      <div class="container">
        <h1>üìö K√ºt√ºphane</h1>
        <div class="subtitle">ISBN ile hƒ±zlƒ± ekle, listeden y√∂net. Renkli ve modern aray√ºz.</div>
      </div>
    </div>

    <div class="container surface">

      <div class="grid">
        <div class="card">
          <div class="row">
            <input id="isbnInput" placeholder="ISBN girin (√∂rn. 9789754341966)" />
            <button id="addBtn" class="btn btn-primary">‚ûï Ekle</button>
            <button id="refreshBtn" class="btn btn-outline">‚Üª Yenile</button>
          </div>
          <div id="message" class="muted" style="margin-top:8px">ISBN ile ekle: Sunucu Open Library'den ba≈ülƒ±k/yazar bilgilerini alƒ±r.</div>
        </div>

        <div class="card">
          <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div class="row">
              <button id="deleteSelectedBtn" class="btn btn-danger">üóëÔ∏è Se√ßiliyi Sil</button>
            </div>
            <div class="muted"><input type="checkbox" id="selectAllChk" /> Hepsini se√ß</div>
          </div>
          <table>
            <thead>
              <tr>
                <th></th>
                <th>ISBN</th>
                <th>Ba≈ülƒ±k</th>
                <th>Yazar</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="booksBody"></tbody>
          </table>
        </div>
      </div>

      <div class="footer">API: <code>GET /books</code> ¬∑ <code>POST /books</code> ¬∑ <code>DELETE /books/{isbn}</code></div>
    </div>

    <script>
      const booksBody = document.getElementById('booksBody');
      const isbnInput = document.getElementById('isbnInput');
      const addBtn = document.getElementById('addBtn');
      const refreshBtn = document.getElementById('refreshBtn');
      const messageEl = document.getElementById('message');
      const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
      const selectAllChk = document.getElementById('selectAllChk');

      function setMessage(text, kind = 'info') {
        messageEl.textContent = text;
        messageEl.className = kind === 'error' ? 'error' : (kind === 'success' ? 'success' : 'muted');
      }

      async function fetchBooks() {
        setMessage('Y√ºkleniyor...');
        try {
          const res = await fetch('/books');
          if (!res.ok) throw new Error('Liste alƒ±namadƒ±');
          const data = await res.json();
          renderBooks(data);
          setMessage('Liste g√ºncel.');
        } catch (e) {
          setMessage('Hata: ' + (e && e.message ? e.message : e), 'error');
        }
      }

      function renderBooks(books) {
        booksBody.innerHTML = '';
        if (!books || books.length === 0) {
          const tr = document.createElement('tr');
          const td = document.createElement('td');
          td.colSpan = 5;
          td.textContent = 'Kayƒ±t yok';
          tr.appendChild(td);
          booksBody.appendChild(tr);
          return;
        }
        for (const b of books) {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><input type="checkbox" class="rowChk" data-isbn="${b.isbn}" /></td>
            <td>${b.isbn}</td>
            <td>${b.title}</td>
            <td>${b.author}</td>
            <td><button data-isbn="${b.isbn}" class="delBtn">Sil</button></td>
          `;
          booksBody.appendChild(tr);
        }
        document.querySelectorAll('.delBtn').forEach(btn => {
          btn.addEventListener('click', async (ev) => {
            const isbn = ev.target.getAttribute('data-isbn');
            await deleteBook(isbn);
          });
        });
        document.querySelectorAll('.rowChk').forEach(chk => {
          chk.addEventListener('change', syncHeaderCheckbox);
        });
        syncHeaderCheckbox();
      }

      async function addBook() {
        const isbn = isbnInput.value.trim();
        if (!isbn) { setMessage('ISBN giriniz.', 'error'); return; }
        setMessage('Ekleniyor...');
        try {
          const res = await fetch('/books', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ isbn })
          });
          if (!res.ok) {
            const err = await res.json().catch(() => ({}));
            throw new Error(err.detail || 'Ekleme ba≈üarƒ±sƒ±z');
          }
          isbnInput.value = '';
          setMessage('Kitap eklendi.', 'success');
          await fetchBooks();
        } catch (e) {
          setMessage('Hata: ' + (e && e.message ? e.message : e), 'error');
        }
      }

      async function deleteBook(isbn) {
        setMessage('Siliniyor...');
        try {
          const res = await fetch(`/books/${encodeURIComponent(isbn)}`, { method: 'DELETE' });
          if (res.status !== 204) {
            const err = await res.json().catch(() => ({}));
            throw new Error(err.detail || 'Silme ba≈üarƒ±sƒ±z');
          }
          setMessage('Silindi.', 'success');
          await fetchBooks();
        } catch (e) {
          setMessage('Hata: ' + (e && e.message ? e.message : e), 'error');
        }
      }

      function getSelectedIsbns() {
        return Array.from(document.querySelectorAll('.rowChk'))
          .filter(chk => chk.checked)
          .map(chk => chk.getAttribute('data-isbn'));
      }

      function syncHeaderCheckbox() {
        const checks = Array.from(document.querySelectorAll('.rowChk'));
        if (checks.length === 0) { selectAllChk.checked = false; selectAllChk.indeterminate = false; return; }
        const checked = checks.filter(c => c.checked).length;
        selectAllChk.checked = checked === checks.length;
        selectAllChk.indeterminate = checked > 0 && checked < checks.length;
      }

      async function deleteSelected() {
        const isbns = getSelectedIsbns();
        if (isbns.length === 0) { setMessage('Hi√ß se√ßim yok.', 'error'); return; }
        setMessage('Toplu siliniyor...');
        try {
          const res = await fetch('/books', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ isbns })
          });
          if (!res.ok) {
            const err = await res.json().catch(() => ({}));
            throw new Error(err.detail || 'Toplu silme ba≈üarƒ±sƒ±z');
          }
          const result = await res.json();
          const nf = (result && result.not_found) || [];
          if (nf.length > 0) {
            setMessage(`Silindi: ${isbns.length - nf.length}, Bulunamadƒ±: ${nf.length}`, 'error');
          } else {
            setMessage(`Silindi: ${isbns.length}`, 'success');
          }
          await fetchBooks();
        } catch (e) {
          setMessage('Hata: ' + (e && e.message ? e.message : e), 'error');
        }
      }

      addBtn.addEventListener('click', addBook);
      refreshBtn.addEventListener('click', fetchBooks);
      deleteSelectedBtn.addEventListener('click', deleteSelected);
      selectAllChk.addEventListener('change', () => {
        const checked = selectAllChk.checked;
        document.querySelectorAll('.rowChk').forEach(chk => { chk.checked = checked; });
        syncHeaderCheckbox();
      });
      window.addEventListener('DOMContentLoaded', fetchBooks);
    </script>
  </body>
</html>



